<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Prescriptions</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <nav class="navbar">
        <div class="navbar-brand">Lens Web App</div>
        <div class="navbar-right">
            <button onclick="logoutUser()" class="btn btn-logout">Logout</button>
        </div>
    </nav>

    <main class="container">
        <h2>Prescription History</h2>
        
        <div class="search-bar">
            <input type="text" id="searchMobile" placeholder="Enter Mobile Number">
            <button onclick="searchPrescription()" class="btn btn-search">Search</button>
        </div>

        <table id="prescriptionTable">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Patient Name</th>
                    <th>Age</th>
                    <th>Gender</th>
                    <th>Mobile</th>
                    <th>Amount</th>
                    <th>Vision Type</th>
                    <th>Lens Type</th>
                    <th>Frame Type</th>
                    <th>Payment Mode</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </main>

    <script>
        const scriptURL = "YOUR_GOOGLE_SCRIPT_URL";

        document.addEventListener("DOMContentLoaded", function () {
            fetchPrescriptions();
        });

        function fetchPrescriptions() {
            const username = localStorage.getItem("username");
            
            fetch(scriptURL, {
                method: "POST",
                body: JSON.stringify({ action: "fetchPrescriptions", username: username })
            })
            .then(response => response.json())
            .then(result => {
                if (result.status === "success") {
                    displayPrescriptions(result.data);
                } else {
                    alert("No prescriptions found!");
                }
            })
            .catch(error => console.error("Error:", error));
        }

        function searchPrescription() {
            const mobile = document.getElementById("searchMobile").value.trim();
            if (!mobile) {
                alert("Please enter a mobile number.");
                return;
            }
            
            fetch(scriptURL, {
                method: "POST",
                body: JSON.stringify({ action: "searchPrescription", mobile: mobile })
            })
            .then(response => response.json())
            .then(result => {
                if (result.status === "success" && result.data.length > 0) {
                    displayPrescriptions(result.data);
                } else {
                    alert("No records found for this mobile number.");
                }
            })
            .catch(error => console.error("Error:", error));
        }

        function displayPrescriptions(data) {
            const tbody = document.getElementById("prescriptionTable").getElementsByTagName("tbody")[0];
            tbody.innerHTML = ""; // Clear existing rows

            data.forEach(row => {
                let tr = document.createElement("tr");
                row.forEach(cell => {
                    let td = document.createElement("td");
                    td.textContent = cell;
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });
        }

        function logoutUser() {
            localStorage.removeItem("username");
            window.location.href = "login.html";
        }
    </script>
</body>
</html>
